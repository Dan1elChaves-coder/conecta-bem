(function(){function showMessage(id,text,type){const el=document.getElementById(id);if(!el)return;el.textContent=text||'';el.className='field-msg '+(type?('msg-'+type):'');}function validateCPF(v){return /^\d{3}\.\d{3}\.\d{3}-\d{2}$/.test(v);}function validateEmail(v){return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v);}function markField(el,ok){if(!el)return;el.classList.remove('input-error','input-success');if(ok===true)el.classList.add('input-success');if(ok===false)el.classList.add('input-error');}document.addEventListener('submit',function(e){if(e.target&&e.target.id==='formCadastro'){e.preventDefault();let valid=true;const nome=document.getElementById('nome');const email=document.getElementById('email');const cpf=document.getElementById('cpf');const telefone=document.getElementById('telefone');const nascimento=document.getElementById('nascimento');const cep=document.getElementById('cep');const cidade=document.getElementById('cidade');const estado=document.getElementById('estado');if(!nome.value.trim()){showMessage('msg-nome','Nome obrigatório','error');markField(nome,false);valid=false;}else{showMessage('msg-nome','');markField(nome,true);}if(!validateEmail(email.value.trim())){showMessage('msg-email','E-mail inválido','error');markField(email,false);valid=false;}else{showMessage('msg-email','');markField(email,true);}if(!validateCPF(cpf.value.trim())){showMessage('msg-cpf','CPF inválido. Use o formato 000.000.000-00','error');markField(cpf,false);valid=false;}else{showMessage('msg-cpf','');markField(cpf,true);}if(!telefone.value.trim()||telefone.value.replace(/\D/g,'').length<10){showMessage('msg-telefone','Telefone inválido','error');markField(telefone,false);valid=false;}else{showMessage('msg-telefone','');markField(telefone,true);}if(!nascimento.value){showMessage('msg-nascimento','Data de nascimento obrigatória','error');markField(nascimento,false);valid=false;}else{showMessage('msg-nascimento','');markField(nascimento,true);}if(!cep.value.trim()||cep.value.replace(/\D/g,'').length!==8){showMessage('msg-cep','CEP inválido','error');markField(cep,false);valid=false;}else{showMessage('msg-cep','');markField(cep,true);}if(!cidade.value.trim()){showMessage('msg-cidade','Cidade obrigatória','error');markField(cidade,false);valid=false;}else{showMessage('msg-cidade','');markField(cidade,true);}if(!estado.value){showMessage('msg-estado','Escolha um estado','error');markField(estado,false);valid=false;}else{showMessage('msg-estado','');markField(estado,true);}if(!valid){const first=document.querySelector('.input-error');if(first)first.focus();return;}const user={nome:nome.value.trim(),email:email.value.trim(),cpf:cpf.value.trim(),telefone:telefone.value.trim(),nascimento:nascimento.value,cep:cep.value.trim(),cidade:cidade.value.trim(),estado:estado.value};const users=JSON.parse(localStorage.getItem('conectabem_users')||'[]');users.push(user);localStorage.setItem('conectabem_users',JSON.stringify(users));alert('Cadastro realizado com sucesso! Obrigado por se juntar ao Conecta Bem.');e.target.reset();}});document.addEventListener('input',function(e){if(!e.target)return;if(e.target.id==='cpf'){let v=e.target.value.replace(/\D/g,'');v=v.replace(/(\d{3})(\d)/,'$1.$2');v=v.replace(/(\d{3})\.(\d{3})(\d)/,'$1.$2.$3');v=v.replace(/(\d{3})\.(\d{3})\.(\d{3})(\d)/,'$1.$2.$3-$4');e.target.value=v.substring(0,14);}if(e.target.id==='telefone'){let v=e.target.value.replace(/\D/g,'');if(v.length<=2)e.target.value=v;else if(v.length<=6)e.target.value=v.replace(/(\d{2})(\d+)/,'($1) $2');else if(v.length<=10)e.target.value=v.replace(/(\d{2})(\d{4})(\d+)/,'($1) $2-$3');else e.target.value=v.replace(/(\d{2})(\d{5})(\d+)/,'($1) $2-$3');}if(e.target.id==='cep'){let v=e.target.value.replace(/\D/g,'');if(v.length>5)e.target.value=v.replace(/(\d{5})(\d+)/,'$1-$2').substring(0,9);else e.target.value=v;}});